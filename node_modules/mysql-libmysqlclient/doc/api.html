<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head>
        <title>Node-mysql-libmysqlclient API</title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
        <style>body {
    margin: 0;
    padding: 0;
    font: 14px/1.5 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
    color: #252519;
}
a {
    color: #252519;
}
a:hover {
    text-decoration: underline;
    color: #19469D;
}
p {
    margin: 12px 0;
}
h1, h2, h3 {
    margin: 0;
    padding: 0;
}
ul {
    padding-left: 20px;
}
img {
    border: 0;
}
table#source {
    width: 100%;
    border-collapse: collapse;
}
table#source td:first-child {
    padding: 30px;
    vertical-align: top;
}
table#source td:first-child,
table#source td:first-child pre {
    width: 450px;
}
table#source td:last-child {
    padding: 30px;
    border-left: 1px solid #E5E5EE;
    background: #F5F5FF;
}
table#source tr {
    border-bottom: 1px solid #E5E5EE;
}
table#source tr.filename {
    padding-top: 40px;
    border-top: 1px solid #E5E5EE;
}
table#source tr.filename td:first-child {
    cursor: pointer;
    text-transform: capitalize;
}
table#source tr.filename td:last-child {
    font-size: 12px;
}
table#source tr.filename h2 {
    margin: 0;
    padding: 0;
    text-decoration: underline;
}
table#source tr.code h1,
table#source tr.code h2,
table#source tr.code h3 {
    margin-top: 30px;
    font-family: "Lucida Grande", "Helvetica Nueue", Arial, sans-serif;
    font-size: 18px;
}
table#source tr.code h2 {
    font-size: 16px;
}
table#source tr.code h3 {
    font-size: 14px;
}
table#source tr.code ul {
    margin: 15px 0 15px 35px;
    padding: 0;
}
table#source tr.code ul li {
    margin: 0;
    padding: 1px 0;
}
table#source tr.code ul li p {
    margin: 0;
    padding: 0;
}
table#source tr.code td:first-child pre {
    padding: 20px;
}
#ribbon {
    position: fixed;
    top: 0;
    right: 0;
}
code .string { color: #219161; }
code .regexp { color: #219161; }
code .keyword { color: #954121; }
code .number { color: #19469D; }
code .comment { color: #bbb; }
code .this { color: #19469D; }
pre.shell code .prompt-user { color: #219121; }
pre.shell code .prompt-root { color: #912121; }

</style>
        <script>
            $(function(){
                if ($('tr.filename').length) {
                    $('tr.code').hide();
                    $('tr.filename').toggle(function(){
                        $(this).nextUntil('.filename').fadeIn();
                    }, function(){
                        $(this).nextUntil('.filename').fadeOut();
                    });
                }
            });
        </script>
    </head>
    <body>
        <a href="http://github.com/Sannis/node-mysql-libmysqlclient"><img alt="Fork me on GitHub" id="ribbon" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
        <table id="source"><tbody>
            <tr>
                <td><h1>Node-mysql-libmysqlclient API</h1>
<p>MySQL bindings for <a href="http://nodejs.org">Node.js</a> using libmysqlclient.</p>

<p>Check out the <a href="http://github.com/Sannis/node-mysql-libmysqlclient">Github repo</a> for the source and installation guide.</p>

<p>Extra information: <a href="./index.html">Homepage</a>, <a href="./changelog.html">ChangeLog</a>, <a href="./examples.html">Examples</a>, <a href="http://github.com/Sannis/node-mysql-libmysqlclient/wiki">Wiki</a>.</p>
                </td>
                <td>

                </td>
            </tr>
            <tr class="filename">
                <td>
<h2 id="mysql-libmysqlclient">mysql-libmysqlclient</h2>
                </td>
                <td>
./mysql-libmysqlclient.js
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Create connection to database</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String | null</em>  hostname</p></li><li><p><strong>param</strong>: <em>String | null</em>  user</p></li><li><p><strong>param</strong>: <em>String | null</em>  password</p></li><li><p><strong>param</strong>: <em>String | null</em>  database</p></li><li><p><strong>param</strong>: <em>Integer | null</em>  port</p></li><li><p><strong>param</strong>: <em>String | null</em>  socket</p></li><li><p><strong>return</strong>: <em>MysqlConnection</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="variable">exports</span>.<span class="variable">createConnectionSync</span> = <span class="keyword">function</span> () {
  <span class="keyword">var</span> <span class="variable">db</span> = <span class="keyword">new</span> <span class="variable">binding</span>.<span class="class">MysqlConnection</span>();
  <span class="keyword">if</span> (<span class="variable">arguments</span>.<span class="variable">length</span> &gt; <span class="number integer">0</span>) {
    <span class="variable">db</span>.<span class="variable">connectSync</span>.<span class="variable">apply</span>(<span class="variable">db</span>, <span class="class">Array</span>.<span class="variable">prototype</span>.<span class="variable">slice</span>.<span class="variable">call</span>(<span class="variable">arguments</span>, <span class="number integer">0</span>, <span class="number integer">6</span>));
  }
  <span class="keyword">return</span> <span class="variable">db</span>;
};
</code></pre>
                </td>
            </tr>
            <tr class="filename">
                <td>
<h2 id="mysql_bindings">mysql_bindings</h2>
                </td>
                <td>
./src/mysql_bindings.cc
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Init V8 structures</p>

<p>Classes to populate in JavaScript:</p>

<ul><li>MysqlConnection</li><li>MysqlResult</li><li>MysqlStatement</li></ul>
                </td>
                <td>
<pre><code><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="keyword">void</span> <span class="variable">init</span>(<span class="class">Handle</span>&lt;<span class="class">Object</span>&gt; <span class="variable">target</span>) {
    <span class="class">MysqlConnection</span>::<span class="class">Init</span>(<span class="variable">target</span>);
    <span class="class">MysqlResult</span>::<span class="class">Init</span>(<span class="variable">target</span>);
    <span class="class">MysqlStatement</span>::<span class="class">Init</span>(<span class="variable">target</span>);
}

</code></pre>
                </td>
            </tr>
            <tr class="filename">
                <td>
<h2 id="mysql_bindings_connection">mysql_bindings_connection</h2>
                </td>
                <td>
./src/mysql_bindings_connection.cc
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Creates new MysqlConnection object</p>

<ul><li><p><strong>constructor</strong></p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">New</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="variable">new</span> <span class="class">MysqlConnection</span>();
    <span class="variable">conn</span>-&gt;<span class="class">Wrap</span>(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="keyword">return</span> <span class="variable">args</span>.<span class="class">This</span>();
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Gets last connect error number</p>

<ul><li><strong>getter</strong></li></ul>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Integer</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">ConnectErrnoGetter</span>(<span class="class">Local</span>&lt;<span class="class">String</span>&gt; <span class="variable">property</span>,
                                            <span class="keyword">const</span> <span class="class">AccessorInfo</span> &amp;<span class="variable">info</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">info</span>.<span class="class">Holder</span>());

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">conn</span>-&gt;<span class="variable">connect_errno</span>));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Gets last connect error string</p>

<ul><li><strong>getter</strong></li></ul>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Integer</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">ConnectErrorGetter</span>(<span class="class">Local</span>&lt;<span class="class">String</span>&gt; <span class="variable">property</span>,
                                            <span class="keyword">const</span> <span class="class">AccessorInfo</span> &amp;<span class="variable">info</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">info</span>.<span class="class">Holder</span>());

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">V8STR</span>(<span class="variable">conn</span>-&gt;<span class="variable">connect_error</span> ? <span class="variable">conn</span>-&gt;<span class="variable">connect_error</span> : <span class="string">&quot;&quot;</span>));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Gets number of affected rows in previous operation</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Integer</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">AffectedRowsSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="variable">my_ulonglong</span> <span class="variable">affected_rows</span> = <span class="variable">mysql_affected_rows</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);

    <span class="keyword">if</span> (<span class="variable">affected_rows</span> == ((<span class="variable">my_ulonglong</span>)-<span class="number integer">1</span>)) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">Integer</span>::<span class="class">New</span>(-<span class="number integer">1</span>));
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">Integer</span>::<span class="class">New</span>(<span class="variable">affected_rows</span>));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Sets autocommit mode</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Boolean</em>  mode</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">AutoCommitSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">REQ_BOOL_ARG</span>(<span class="number integer">0</span>, <span class="variable">autocomit</span>)

    <span class="keyword">if</span> (<span class="variable">mysql_autocommit</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>, <span class="variable">autocomit</span>)) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Changes the user and causes the database to become the default</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  user</p></li><li><p><strong>param</strong>: <em>String | null</em>  password</p></li><li><p><strong>param</strong>: <em>String | null</em>  database</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">ChangeUserSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">REQ_STR_ARG</span>(<span class="number integer">0</span>, <span class="variable">user</span>)

    <span class="comment">// TODO(Sannis): Check logic</span>
    <span class="keyword">if</span> ( (<span class="variable">args</span>.<span class="class">Length</span>() &lt; <span class="number integer">2</span>) || (!<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">IsString</span>()) ||
         (!<span class="variable">args</span>[<span class="number integer">1</span>]-&gt;<span class="class">IsString</span>()) ) {
        <span class="keyword">return</span> <span class="class">THRTYPEEXC</span>(<span class="string">&quot;Must give at least user and password as arguments&quot;</span>);
    }
    <span class="class">String</span>::<span class="class">Utf8Value</span> <span class="variable">password</span>(<span class="variable">args</span>[<span class="number integer">1</span>]-&gt;<span class="class">ToString</span>());

    <span class="keyword">if</span> ( (<span class="variable">args</span>.<span class="class">Length</span>() == <span class="number integer">3</span>) &amp;&amp; (!<span class="variable">args</span>[<span class="number integer">2</span>]-&gt;<span class="class">IsString</span>()) ) {
        <span class="keyword">return</span> <span class="class">THRTYPEEXC</span>(<span class="string">&quot;Must give string value as third argument, dbname&quot;</span>);
    }
    <span class="class">String</span>::<span class="class">Utf8Value</span> <span class="variable">dbname</span>(<span class="variable">args</span>[<span class="number integer">2</span>]-&gt;<span class="class">ToString</span>());

    <span class="variable">bool</span> <span class="variable">r</span> = <span class="variable">mysql_change_user</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>,
                               *<span class="variable">user</span>,
                               <span class="variable">args</span>[<span class="number integer">1</span>]-&gt;<span class="class">IsString</span>() ? *<span class="variable">password</span> : <span class="class">NULL</span>,
                               <span class="variable">args</span>[<span class="number integer">2</span>]-&gt;<span class="class">IsString</span>() ? *<span class="variable">dbname</span> : <span class="class">NULL</span>);

    <span class="keyword">if</span> (<span class="variable">r</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Commits the current transaction</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">CommitSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">if</span> (<span class="variable">mysql_commit</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>EIO wrapper functions for MysqlConnection::Connect
 </p>
                </td>
                <td>
<pre><code><span class="directive">#ifndef MYSQL_NON_THREADSAFE</span>
<span class="keyword">int</span> <span class="class">MysqlConnection</span>::<span class="class">EIO_After_Connect</span>(<span class="variable">eio_req</span> *<span class="variable">req</span>) {
    <span class="variable">ev_unref</span>(<span class="class">EV_DEFAULT_UC</span>);
    <span class="class">HandleScope</span> <span class="variable">scope</span>;
    <span class="keyword">struct</span> <span class="variable">connect_request</span> *<span class="variable">conn_req</span> = (<span class="keyword">struct</span> <span class="variable">connect_request</span> *)(<span class="variable">req</span>-&gt;<span class="variable">data</span>);

    <span class="class">Local</span>&lt;<span class="class">Value</span>&gt; <span class="variable">argv</span>[<span class="number integer">1</span>];

    <span class="keyword">if</span> (<span class="variable">req</span>-&gt;<span class="variable">result</span>) {
        <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="variable">error_string_length</span> =
                                    <span class="variable">strlen</span>(<span class="variable">conn_req</span>-&gt;<span class="variable">conn</span>-&gt;<span class="variable">connect_error</span>) + <span class="number integer">25</span>;
        <span class="keyword">char</span>* <span class="variable">error_string</span> = <span class="variable">new</span> <span class="keyword">char</span>[<span class="variable">error_string_length</span>];
        <span class="variable">snprintf</span>(<span class="variable">error_string</span>, <span class="variable">error_string_length</span>, <span class="string">&quot;Connection error #%d: %s&quot;</span>,
               <span class="variable">conn_req</span>-&gt;<span class="variable">errno</span>, <span class="variable">conn_req</span>-&gt;<span class="variable">error</span>);

        <span class="variable">argv</span>[<span class="number integer">0</span>] = <span class="class">V8EXC</span>(<span class="variable">error_string</span>);
        <span class="variable">delete</span>[] <span class="variable">error_string</span>;
    } <span class="keyword">else</span> {
        <span class="variable">argv</span>[<span class="number integer">0</span>] = <span class="class">Local</span>&lt;<span class="class">Value</span>&gt;::<span class="class">New</span>(<span class="class">Null</span>());
    }

    <span class="class">TryCatch</span> <span class="variable">try_catch</span>;

    <span class="variable">conn_req</span>-&gt;<span class="variable">callback</span>-&gt;<span class="class">Call</span>(<span class="class">Context</span>::<span class="class">GetCurrent</span>()-&gt;<span class="class">Global</span>(), <span class="number integer">1</span>, <span class="variable">argv</span>);

    <span class="keyword">if</span> (<span class="variable">try_catch</span>.<span class="class">HasCaught</span>()) {
        <span class="variable">node</span>::<span class="class">FatalException</span>(<span class="variable">try_catch</span>);
    }

    <span class="variable">conn_req</span>-&gt;<span class="variable">callback</span>.<span class="class">Dispose</span>();
    <span class="variable">conn_req</span>-&gt;<span class="variable">conn</span>-&gt;<span class="class">Unref</span>();
    <span class="variable">free</span>(<span class="variable">conn_req</span>);

    <span class="keyword">return</span> <span class="number integer">0</span>;
}

<span class="keyword">int</span> <span class="class">MysqlConnection</span>::<span class="class">EIO_Connect</span>(<span class="variable">eio_req</span> *<span class="variable">req</span>) {
    <span class="keyword">struct</span> <span class="variable">connect_request</span> *<span class="variable">conn_req</span> = (<span class="keyword">struct</span> <span class="variable">connect_request</span> *)(<span class="variable">req</span>-&gt;<span class="variable">data</span>);

    <span class="variable">req</span>-&gt;<span class="variable">result</span> = <span class="variable">conn_req</span>-&gt;<span class="variable">conn</span>-&gt;<span class="class">Connect</span>(
                    <span class="variable">conn_req</span>-&gt;<span class="variable">hostname</span> ? **(<span class="variable">conn_req</span>-&gt;<span class="variable">hostname</span>) : <span class="class">NULL</span>,
                    <span class="variable">conn_req</span>-&gt;<span class="variable">user</span> ? **(<span class="variable">conn_req</span>-&gt;<span class="variable">user</span>) : <span class="class">NULL</span>,
                    <span class="variable">conn_req</span>-&gt;<span class="variable">password</span> ? **(<span class="variable">conn_req</span>-&gt;<span class="variable">password</span>) : <span class="class">NULL</span>,
                    <span class="variable">conn_req</span>-&gt;<span class="variable">dbname</span> ? **(<span class="variable">conn_req</span>-&gt;<span class="variable">dbname</span>) : <span class="class">NULL</span>,
                    <span class="variable">conn_req</span>-&gt;<span class="variable">port</span>,
                    <span class="variable">conn_req</span>-&gt;<span class="variable">socket</span> ? **(<span class="variable">conn_req</span>-&gt;<span class="variable">socket</span>) : <span class="class">NULL</span>,
                    <span class="variable">conn_req</span>-&gt;<span class="variable">flags</span>) ? <span class="number integer">0</span> : <span class="number integer">1</span>;

    <span class="keyword">if</span> (<span class="variable">req</span>-&gt;<span class="variable">result</span>) {
        <span class="variable">conn_req</span>-&gt;<span class="variable">errno</span> = <span class="variable">conn_req</span>-&gt;<span class="variable">conn</span>-&gt;<span class="variable">connect_errno</span>;
        <span class="variable">conn_req</span>-&gt;<span class="variable">error</span> = <span class="variable">conn_req</span>-&gt;<span class="variable">conn</span>-&gt;<span class="variable">connect_error</span>;
    }

    <span class="variable">delete</span> <span class="variable">conn_req</span>-&gt;<span class="variable">hostname</span>;
    <span class="variable">delete</span> <span class="variable">conn_req</span>-&gt;<span class="variable">user</span>;
    <span class="variable">delete</span> <span class="variable">conn_req</span>-&gt;<span class="variable">password</span>;
    <span class="variable">delete</span> <span class="variable">conn_req</span>-&gt;<span class="variable">socket</span>;

    <span class="keyword">return</span> <span class="number integer">0</span>;
}
<span class="directive">#endif</span></code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Opens a new connection to the MySQL server</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String | null</em>  hostname</p></li><li><p><strong>param</strong>: <em>String | null</em>  user</p></li><li><p><strong>param</strong>: <em>String | null</em>  password</p></li><li><p><strong>param</strong>: <em>String | null</em>  database</p></li><li><p><strong>param</strong>: <em>Integer | null</em>  port</p></li><li><p><strong>param</strong>: <em>String | null</em>  socket</p></li><li><p><strong>param</strong>: <em>Function(error)</em>  callback</p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">Connect</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;
<span class="directive">#ifdef MYSQL_NON_THREADSAFE</span>
    <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="class">MYSQL_NON_THREADSAFE_ERRORSTRING</span>);
<span class="directive">#else</span>
    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="keyword">struct</span> <span class="variable">connect_request</span> *<span class="variable">conn_req</span> =
         (<span class="keyword">struct</span> <span class="variable">connect_request</span> *)<span class="variable">calloc</span>(<span class="number integer">1</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <span class="variable">connect_request</span>));

    <span class="keyword">if</span> (!<span class="variable">conn_req</span>) {
      <span class="class">V8</span>::<span class="class">LowMemoryNotification</span>();
      <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;Could not allocate enough memory&quot;</span>);
    }

    <span class="class">REQ_FUN_ARG</span>(<span class="variable">args</span>.<span class="class">Length</span>() - <span class="number integer">1</span>, <span class="variable">callback</span>);
    <span class="variable">conn_req</span>-&gt;<span class="variable">callback</span> = <span class="class">Persistent</span>&lt;<span class="class">Function</span>&gt;::<span class="class">New</span>(<span class="variable">callback</span>);
    <span class="variable">conn_req</span>-&gt;<span class="variable">conn</span> = <span class="variable">conn</span>;

    <span class="variable">conn_req</span>-&gt;<span class="variable">hostname</span> = <span class="variable">args</span>.<span class="class">Length</span>() &gt; <span class="number integer">1</span> &amp;&amp; <span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">IsString</span>() ?
        <span class="variable">new</span> <span class="class">String</span>::<span class="class">Utf8Value</span>(<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">ToString</span>()) : <span class="class">NULL</span>;
    <span class="variable">conn_req</span>-&gt;<span class="variable">user</span> = <span class="variable">args</span>.<span class="class">Length</span>() &gt; <span class="number integer">2</span> &amp;&amp; <span class="variable">args</span>[<span class="number integer">1</span>]-&gt;<span class="class">IsString</span>() ?
        <span class="variable">new</span> <span class="class">String</span>::<span class="class">Utf8Value</span>(<span class="variable">args</span>[<span class="number integer">1</span>]-&gt;<span class="class">ToString</span>()) : <span class="class">NULL</span>;
    <span class="variable">conn_req</span>-&gt;<span class="variable">password</span> = <span class="variable">args</span>.<span class="class">Length</span>() &gt; <span class="number integer">3</span> &amp;&amp; <span class="variable">args</span>[<span class="number integer">2</span>]-&gt;<span class="class">IsString</span>() ?
        <span class="variable">new</span> <span class="class">String</span>::<span class="class">Utf8Value</span>(<span class="variable">args</span>[<span class="number integer">2</span>]-&gt;<span class="class">ToString</span>()) : <span class="class">NULL</span>;
    <span class="variable">conn_req</span>-&gt;<span class="variable">dbname</span> = <span class="variable">args</span>.<span class="class">Length</span>() &gt; <span class="number integer">4</span> &amp;&amp; <span class="variable">args</span>[<span class="number integer">3</span>]-&gt;<span class="class">IsString</span>() ?
        <span class="variable">new</span> <span class="class">String</span>::<span class="class">Utf8Value</span>(<span class="variable">args</span>[<span class="number integer">3</span>]-&gt;<span class="class">ToString</span>()) : <span class="class">NULL</span>;
    <span class="variable">conn_req</span>-&gt;<span class="variable">port</span> = <span class="variable">args</span>.<span class="class">Length</span>() &gt; <span class="number integer">5</span> &amp;&amp; <span class="variable">args</span>[<span class="number integer">4</span>]-&gt;<span class="class">IsUint32</span>() ?
                            <span class="variable">args</span>[<span class="number integer">4</span>]-&gt;<span class="class">Uint32Value</span>() : <span class="number integer">0</span>;
    <span class="variable">conn_req</span>-&gt;<span class="variable">socket</span> = <span class="variable">args</span>.<span class="class">Length</span>() &gt; <span class="number integer">6</span> &amp;&amp; <span class="variable">args</span>[<span class="number integer">5</span>]-&gt;<span class="class">IsString</span>() ?
        <span class="variable">new</span> <span class="class">String</span>::<span class="class">Utf8Value</span>(<span class="variable">args</span>[<span class="number integer">5</span>]-&gt;<span class="class">ToString</span>()) : <span class="class">NULL</span>;
    <span class="variable">conn_req</span>-&gt;<span class="variable">flags</span> = <span class="variable">args</span>.<span class="class">Length</span>() &gt; <span class="number integer">7</span> &amp;&amp; <span class="variable">args</span>[<span class="number integer">6</span>]-&gt;<span class="class">IsUint32</span>() ?
                            <span class="variable">args</span>[<span class="number integer">6</span>]-&gt;<span class="class">Uint32Value</span>() : <span class="number integer">0</span>;
    <span class="variable">eio_custom</span>(<span class="class">EIO_Connect</span>, <span class="class">EIO_PRI_DEFAULT</span>, <span class="class">EIO_After_Connect</span>, <span class="variable">conn_req</span>);

    <span class="variable">ev_ref</span>(<span class="class">EV_DEFAULT_UC</span>);
    <span class="variable">conn</span>-&gt;<span class="class">Ref</span>();

    <span class="keyword">return</span> <span class="class">Undefined</span>();
<span class="directive">#endif</span>
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Opens a new connection to the MySQL server</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String | null</em>  hostname</p></li><li><p><strong>param</strong>: <em>String | null</em>  user</p></li><li><p><strong>param</strong>: <em>String | null</em>  password</p></li><li><p><strong>param</strong>: <em>String | null</em>  database</p></li><li><p><strong>param</strong>: <em>Integer | null</em>  port</p></li><li><p><strong>param</strong>: <em>String | null</em>  socket</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">ConnectSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="keyword">if</span> (<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>) {
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;Already initialized. &quot;</span>
                       <span class="string">&quot;Use conn.realConnectSync() after conn.initSync()&quot;</span>);
    }

    <span class="class">String</span>::<span class="class">Utf8Value</span> <span class="variable">hostname</span>(<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">ToString</span>());
    <span class="class">String</span>::<span class="class">Utf8Value</span> <span class="variable">user</span>(<span class="variable">args</span>[<span class="number integer">1</span>]-&gt;<span class="class">ToString</span>());
    <span class="class">String</span>::<span class="class">Utf8Value</span> <span class="variable">password</span>(<span class="variable">args</span>[<span class="number integer">2</span>]-&gt;<span class="class">ToString</span>());
    <span class="class">String</span>::<span class="class">Utf8Value</span> <span class="variable">dbname</span>(<span class="variable">args</span>[<span class="number integer">3</span>]-&gt;<span class="class">ToString</span>());
    <span class="variable">uint32_t</span> <span class="variable">port</span> = <span class="variable">args</span>[<span class="number integer">4</span>]-&gt;<span class="class">Uint32Value</span>();
    <span class="class">String</span>::<span class="class">Utf8Value</span> <span class="variable">socket</span>(<span class="variable">args</span>[<span class="number integer">5</span>]-&gt;<span class="class">ToString</span>());
    <span class="variable">uint64_t</span> <span class="variable">flags</span> = <span class="variable">args</span>[<span class="number integer">6</span>]-&gt;<span class="class">Uint32Value</span>();

    <span class="variable">bool</span> <span class="variable">r</span> = <span class="variable">conn</span>-&gt;<span class="class">Connect</span>(<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">IsString</span>() ? *<span class="variable">hostname</span> : <span class="class">NULL</span>,
                           <span class="variable">args</span>[<span class="number integer">1</span>]-&gt;<span class="class">IsString</span>() ? *<span class="variable">user</span>     : <span class="class">NULL</span>,
                           <span class="variable">args</span>[<span class="number integer">2</span>]-&gt;<span class="class">IsString</span>() ? *<span class="variable">password</span> : <span class="class">NULL</span>,
                           <span class="variable">args</span>[<span class="number integer">3</span>]-&gt;<span class="class">IsString</span>() ? *<span class="variable">dbname</span>   : <span class="class">NULL</span>,
                           <span class="variable">args</span>[<span class="number integer">4</span>]-&gt;<span class="class">IsUint32</span>() ? <span class="variable">port</span>      : <span class="number integer">0</span>,
                           <span class="variable">args</span>[<span class="number integer">5</span>]-&gt;<span class="class">IsString</span>() ? *<span class="variable">socket</span>   : <span class="class">NULL</span>,
                           <span class="variable">args</span>[<span class="number integer">6</span>]-&gt;<span class="class">IsUint32</span>() ? <span class="variable">flags</span>     : <span class="number integer">0</span>);

    <span class="keyword">if</span> (!<span class="variable">r</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns current connected status</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">ConnectedSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">conn</span>-&gt;<span class="variable">connected</span> ? <span class="class">True</span>() : <span class="class">False</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Closes database connection
 </p>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">CloseSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="variable">conn</span>-&gt;<span class="class">Close</span>();

    <span class="keyword">return</span> <span class="class">Undefined</span>();
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Performs debugging operations</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  debug message</p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">DebugSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">REQ_STR_ARG</span>(<span class="number integer">0</span>, <span class="variable">debug</span>)

    <span class="variable">mysql_debug</span>(*<span class="variable">debug</span>);

    <span class="keyword">return</span> <span class="class">Undefined</span>();
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Dump debugging information into the log</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">DumpDebugInfoSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;
    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">mysql_dump_debug_info</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>) ? <span class="class">False</span>() : <span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns the last error code</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Integer</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">ErrnoSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">mysql_errno</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns a string description of the last error</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">ErrorSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">const</span> <span class="keyword">char</span> *<span class="variable">error</span> = <span class="variable">mysql_error</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">V8STR</span>(<span class="variable">error</span>));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Escapes special characters in a string for use in an SQL statement,
taking into account the current charset of the connection</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  string</p></li><li><p><strong>return</strong>: <em>String</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">EscapeSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">REQ_STR_ARG</span>(<span class="number integer">0</span>, <span class="variable">str</span>)

    <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="variable">len</span> = <span class="variable">static_cast</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt;(<span class="variable">str</span>.<span class="variable">length</span>());
    <span class="keyword">char</span> *<span class="variable">result</span> = <span class="variable">new</span> <span class="keyword">char</span>[<span class="number integer">2</span>*<span class="variable">len</span> + <span class="number integer">1</span>];
    <span class="keyword">if</span> (!<span class="variable">result</span>) {
        <span class="class">V8</span>::<span class="class">LowMemoryNotification</span>();
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;Not enough memory&quot;</span>);
    }

    <span class="variable">mysql_real_escape_string</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>, <span class="variable">result</span>, *<span class="variable">str</span>, <span class="variable">len</span>);
    <span class="class">Local</span>&lt;<span class="class">Value</span>&gt; <span class="variable">js_result</span> = <span class="class">V8STR</span>(<span class="variable">result</span>);

    <span class="variable">delete</span>[] <span class="variable">result</span>;

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns the number of columns for the most recent query</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Integer</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">FieldCountSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(
                <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(
                    <span class="variable">mysql_field_count</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns a character set object</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Object</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">GetCharsetSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">MY_CHARSET_INFO</span> <span class="variable">cs</span>;

    <span class="variable">mysql_get_character_set_info</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>, &amp;<span class="variable">cs</span>);

    <span class="class">Local</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result</span> = <span class="class">Object</span>::<span class="class">New</span>();

    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;charset&quot;</span>), <span class="class">V8STR</span>(<span class="variable">cs</span>.<span class="variable">csname</span> ? <span class="variable">cs</span>.<span class="variable">csname</span> : <span class="string">&quot;&quot;</span>));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;collation&quot;</span>), <span class="class">V8STR</span>(<span class="variable">cs</span>.<span class="variable">name</span> ? <span class="variable">cs</span>.<span class="variable">name</span> : <span class="string">&quot;&quot;</span>));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;dir&quot;</span>), <span class="class">V8STR</span>(<span class="variable">cs</span>.<span class="variable">dir</span> ? <span class="variable">cs</span>.<span class="variable">dir</span> : <span class="string">&quot;&quot;</span>));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;min_length&quot;</span>), <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">cs</span>.<span class="variable">mbminlen</span>));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;max_length&quot;</span>), <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">cs</span>.<span class="variable">mbmaxlen</span>));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;number&quot;</span>), <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">cs</span>.<span class="variable">number</span>));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;state&quot;</span>), <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">cs</span>.<span class="variable">state</span>));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;comment&quot;</span>), <span class="class">V8STR</span>(<span class="variable">cs</span>.<span class="variable">comment</span> ? <span class="variable">cs</span>.<span class="variable">comment</span> : <span class="string">&quot;&quot;</span>));

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns a character set name</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">GetCharsetNameSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">V8STR</span>(<span class="variable">mysql_character_set_name</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns the MySQL client version and information</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Object</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">GetClientInfoSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">Local</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result</span> = <span class="class">Object</span>::<span class="class">New</span>();

    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;client_info&quot;</span>),
                   <span class="class">V8STR</span>(<span class="variable">mysql_get_client_info</span>()));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;client_version&quot;</span>),
                   <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">mysql_get_client_version</span>()));

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns the MySQL client, server, host and protocol version and information</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Object</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">GetInfoSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">Local</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result</span> = <span class="class">Object</span>::<span class="class">New</span>();

    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;client_info&quot;</span>),
                   <span class="class">V8STR</span>(<span class="variable">mysql_get_client_info</span>()));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;client_version&quot;</span>),
                   <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">mysql_get_client_version</span>()));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;server_info&quot;</span>),
                   <span class="class">V8STR</span>(<span class="variable">mysql_get_server_info</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;server_version&quot;</span>),
                   <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(
                       <span class="variable">mysql_get_server_version</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;host_info&quot;</span>),
                   <span class="class">V8STR</span>(<span class="variable">mysql_get_host_info</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)));
    <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;proto_info&quot;</span>),
                   <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">mysql_get_proto_info</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)));

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Retrieves information about the most recently executed query</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">GetInfoStringSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">const</span> <span class="keyword">char</span> *<span class="variable">info</span> = <span class="variable">mysql_info</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">V8STR</span>(<span class="variable">info</span> ? <span class="variable">info</span> : <span class="string">&quot;&quot;</span>));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Gets result of SHOW WARNINGS</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Array</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">GetWarningsSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">MYSQL_RES</span> *<span class="variable">result</span>;
    <span class="class">MYSQL_ROW</span> <span class="variable">row</span>;
    <span class="keyword">int</span> <span class="variable">i</span> = <span class="number integer">0</span>;

    <span class="class">Local</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_warning</span> = <span class="class">Object</span>::<span class="class">New</span>();
    <span class="class">Local</span>&lt;<span class="class">Array</span>&gt; <span class="variable">js_result</span> = <span class="class">Array</span>::<span class="class">New</span>();

    <span class="keyword">if</span> (<span class="variable">mysql_warning_count</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)) {
        <span class="keyword">if</span> (<span class="variable">mysql_real_query</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>, <span class="string">&quot;SHOW WARNINGS&quot;</span>, <span class="number integer">13</span>) == <span class="number integer">0</span>) {
            <span class="variable">result</span> = <span class="variable">mysql_store_result</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);

            <span class="keyword">while</span> ((<span class="variable">row</span> = <span class="variable">mysql_fetch_row</span>(<span class="variable">result</span>))) {
                <span class="variable">js_warning</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;errno&quot;</span>), <span class="class">V8STR</span>(<span class="variable">row</span>[<span class="number integer">1</span>])-&gt;<span class="class">ToInteger</span>());

                <span class="variable">js_warning</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;reason&quot;</span>), <span class="class">V8STR</span>(<span class="variable">row</span>[<span class="number integer">2</span>]));

                <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">Integer</span>::<span class="class">New</span>(<span class="variable">i</span>), <span class="variable">js_warning</span>);

                <span class="variable">i</span>++;
            }

            <span class="variable">mysql_free_result</span>(<span class="variable">result</span>);
        }
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Initializes MysqlConnection</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">InitSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="keyword">if</span> (<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>) {
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;Already initialized&quot;</span>);
    }

    <span class="variable">conn</span>-&gt;<span class="variable">_conn</span> = <span class="variable">mysql_init</span>(<span class="class">NULL</span>);

    <span class="keyword">if</span> (!<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Initializes a statement and returns it</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>MysqlStatement | Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">InitStatementSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQL_STMT</span> *<span class="variable">my_statement</span> = <span class="variable">mysql_stmt_init</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);

    <span class="keyword">if</span> (!<span class="variable">my_statement</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="class">Local</span>&lt;<span class="class">Value</span>&gt; <span class="variable">arg</span> = <span class="class">External</span>::<span class="class">New</span>(<span class="variable">my_statement</span>);
    <span class="class">Persistent</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result</span>(<span class="class">MysqlStatement</span>::<span class="variable">constructor_template</span>-&gt;
                             <span class="class">GetFunction</span>()-&gt;<span class="class">NewInstance</span>(<span class="number integer">1</span>, &amp;<span class="variable">arg</span>));

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns the auto generated id used in the last query</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Integer</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">LastInsertIdSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">MYSQL_RES</span> *<span class="variable">result</span>;
    <span class="variable">my_ulonglong</span> <span class="variable">insert_id</span> = <span class="number integer">0</span>;

    <span class="keyword">if</span> ( (<span class="variable">result</span> = <span class="variable">mysql_store_result</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)) == <span class="number integer">0</span> &amp;&amp;
         <span class="variable">mysql_field_count</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>) == <span class="number integer">0</span> &amp;&amp;
         <span class="variable">mysql_insert_id</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>) != <span class="number integer">0</span>) {
        <span class="variable">insert_id</span> = <span class="variable">mysql_insert_id</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">Integer</span>::<span class="class">New</span>(<span class="variable">insert_id</span>));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Checks if there are any more query results from a multi query</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">MultiMoreResultsSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">if</span> (<span class="variable">mysql_more_results</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Prepare next result from multi_query</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">MultiNextResultSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">if</span> (!<span class="variable">mysql_more_results</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)) {
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;There is no next result set.&quot;</span>
                        <span class="string">&quot;Please, call MultiMoreResultsSync() to check &quot;</span>
                        <span class="string">&quot;whether to call this function/method&quot;</span>);
    }

    <span class="keyword">if</span> (!<span class="variable">mysql_next_result</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Performs a multi_query on the database</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  multi_query</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">MultiRealQuerySync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">REQ_STR_ARG</span>(<span class="number integer">0</span>, <span class="variable">query</span>)

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">MYSQLCONN_ENABLE_MQ</span>;
    <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="variable">query_len</span> = <span class="variable">static_cast</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt;(<span class="variable">query</span>.<span class="variable">length</span>());
    <span class="keyword">if</span> (<span class="variable">mysql_real_query</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>, *<span class="variable">query</span>, <span class="variable">query_len</span>) != <span class="number integer">0</span>) {
        <span class="class">MYSQLCONN_DISABLE_MQ</span>;
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }
    <span class="class">MYSQLCONN_DISABLE_MQ</span>;

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Pings a server connection,
or tries to reconnect if the connection has gone down</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">PingSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">if</span> (<span class="variable">mysql_ping</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>EIO wrapper functions for MysqlConnection::Query
 </p>
                </td>
                <td>
<pre><code><span class="directive">#ifndef MYSQL_NON_THREADSAFE</span>
<span class="keyword">int</span> <span class="class">MysqlConnection</span>::<span class="class">EIO_After_Query</span>(<span class="variable">eio_req</span> *<span class="variable">req</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="variable">ev_unref</span>(<span class="class">EV_DEFAULT_UC</span>);
    <span class="keyword">struct</span> <span class="variable">query_request</span> *<span class="variable">query_req</span> = (<span class="keyword">struct</span> <span class="variable">query_request</span> *)(<span class="variable">req</span>-&gt;<span class="variable">data</span>);

    <span class="keyword">int</span> <span class="variable">argc</span> = <span class="number integer">1</span>;
    <span class="class">Local</span>&lt;<span class="class">Value</span>&gt; <span class="variable">argv</span>[<span class="number integer">3</span>];

    <span class="keyword">if</span> (<span class="variable">req</span>-&gt;<span class="variable">result</span>) {
        <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="variable">error_string_length</span> = <span class="variable">strlen</span>(<span class="variable">query_req</span>-&gt;<span class="variable">error</span>) + <span class="number integer">20</span>;
        <span class="keyword">char</span>* <span class="variable">error_string</span> = <span class="variable">new</span> <span class="keyword">char</span>[<span class="variable">error_string_length</span>];
        <span class="variable">snprintf</span>(<span class="variable">error_string</span>, <span class="variable">error_string_length</span>, <span class="string">&quot;Query error #%d: %s&quot;</span>,
                 <span class="variable">query_req</span>-&gt;<span class="variable">errno</span>, <span class="variable">query_req</span>-&gt;<span class="variable">error</span>);

        <span class="variable">argv</span>[<span class="number integer">0</span>] = <span class="class">V8EXC</span>(<span class="variable">error_string</span>);
        <span class="variable">delete</span>[] <span class="variable">error_string</span>;
    } <span class="keyword">else</span> {
        <span class="keyword">if</span> (<span class="variable">req</span>-&gt;<span class="variable">int1</span>) {
            <span class="variable">argv</span>[<span class="number integer">0</span>] = <span class="class">External</span>::<span class="class">New</span>(<span class="variable">query_req</span>-&gt;<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);
            <span class="variable">argv</span>[<span class="number integer">1</span>] = <span class="class">External</span>::<span class="class">New</span>(<span class="variable">query_req</span>-&gt;<span class="variable">my_result</span>);
            <span class="variable">argv</span>[<span class="number integer">2</span>] = <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">query_req</span>-&gt;<span class="variable">field_count</span>);
            <span class="class">Persistent</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result</span>(<span class="class">MysqlResult</span>::<span class="variable">constructor_template</span>-&gt;
                                     <span class="class">GetFunction</span>()-&gt;<span class="class">NewInstance</span>(<span class="number integer">3</span>, <span class="variable">argv</span>));

            <span class="variable">argv</span>[<span class="number integer">1</span>] = <span class="class">Local</span>&lt;<span class="class">Object</span>&gt;::<span class="class">New</span>(<span class="variable">js_result</span>);
        } <span class="keyword">else</span> {
            <span class="class">Local</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result</span> = <span class="class">Object</span>::<span class="class">New</span>();
            <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;affectedRows&quot;</span>),
                           <span class="class">Integer</span>::<span class="class">New</span>(<span class="variable">query_req</span>-&gt;<span class="variable">affected_rows</span>));
            <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="string">&quot;insertId&quot;</span>),
                           <span class="class">Integer</span>::<span class="class">New</span>(<span class="variable">query_req</span>-&gt;<span class="variable">insert_id</span>));
            <span class="variable">argv</span>[<span class="number integer">1</span>] = <span class="class">Local</span>&lt;<span class="class">Object</span>&gt;::<span class="class">New</span>(<span class="variable">js_result</span>);
        }
        <span class="variable">argc</span> = <span class="number integer">2</span>;
        <span class="variable">argv</span>[<span class="number integer">0</span>] = <span class="class">Local</span>&lt;<span class="class">Value</span>&gt;::<span class="class">New</span>(<span class="class">Null</span>());
    }

    <span class="keyword">if</span> (<span class="variable">query_req</span>-&gt;<span class="variable">callback</span>-&gt;<span class="class">IsFunction</span>()) {
        <span class="class">TryCatch</span> <span class="variable">try_catch</span>;

        <span class="class">Persistent</span>&lt;<span class="class">Function</span>&gt;::<span class="class">Cast</span>(<span class="variable">query_req</span>-&gt;<span class="variable">callback</span>)-&gt;
                              <span class="class">Call</span>(<span class="class">Context</span>::<span class="class">GetCurrent</span>()-&gt;<span class="class">Global</span>(), <span class="variable">argc</span>, <span class="variable">argv</span>);

        <span class="keyword">if</span> (<span class="variable">try_catch</span>.<span class="class">HasCaught</span>()) {
            <span class="variable">node</span>::<span class="class">FatalException</span>(<span class="variable">try_catch</span>);
        }

        <span class="variable">query_req</span>-&gt;<span class="variable">callback</span>.<span class="class">Dispose</span>();
    }

    <span class="variable">query_req</span>-&gt;<span class="variable">conn</span>-&gt;<span class="class">Unref</span>();

    <span class="variable">free</span>(<span class="variable">query_req</span>-&gt;<span class="variable">query</span>);
    <span class="variable">free</span>(<span class="variable">query_req</span>);

    <span class="keyword">return</span> <span class="number integer">0</span>;
}

<span class="keyword">int</span> <span class="class">MysqlConnection</span>::<span class="class">EIO_Query</span>(<span class="variable">eio_req</span> *<span class="variable">req</span>) {
    <span class="keyword">struct</span> <span class="variable">query_request</span> *<span class="variable">query_req</span> = (<span class="keyword">struct</span> <span class="variable">query_request</span> *)(<span class="variable">req</span>-&gt;<span class="variable">data</span>);

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="variable">query_req</span>-&gt;<span class="variable">conn</span>;

    <span class="keyword">if</span> (!<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>) {
        <span class="variable">req</span>-&gt;<span class="variable">result</span> = <span class="number integer">1</span>;
        <span class="keyword">return</span> <span class="number integer">0</span>;
    }

    <span class="class">MYSQLCONN_DISABLE_MQ</span>;

    <span class="variable">pthread_mutex_lock</span>(&amp;<span class="variable">conn</span>-&gt;<span class="variable">query_lock</span>);
    <span class="keyword">int</span> <span class="variable">r</span> = <span class="variable">mysql_query</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>, <span class="variable">query_req</span>-&gt;<span class="variable">query</span>);
    <span class="keyword">if</span> (<span class="variable">r</span> != <span class="number integer">0</span>) {
        <span class="comment">// Query error</span>
        <span class="variable">req</span>-&gt;<span class="variable">result</span> = <span class="number integer">1</span>;

        <span class="variable">query_req</span>-&gt;<span class="variable">errno</span> = <span class="variable">mysql_errno</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);
        <span class="variable">query_req</span>-&gt;<span class="variable">error</span> = <span class="variable">mysql_error</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);
    } <span class="keyword">else</span> {
        <span class="variable">req</span>-&gt;<span class="variable">result</span> = <span class="number integer">0</span>;

        <span class="class">MYSQL_RES</span> *<span class="variable">my_result</span> = <span class="variable">mysql_store_result</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);

        <span class="variable">query_req</span>-&gt;<span class="variable">field_count</span> = <span class="variable">mysql_field_count</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);

        <span class="keyword">if</span> (<span class="variable">my_result</span>) {
            <span class="comment">// Valid result set (may be empty, of cause)</span>
            <span class="variable">req</span>-&gt;<span class="variable">int1</span> = <span class="number integer">1</span>;
            <span class="variable">query_req</span>-&gt;<span class="variable">my_result</span> = <span class="variable">my_result</span>;
        } <span class="keyword">else</span> {
            <span class="keyword">if</span> (<span class="variable">query_req</span>-&gt;<span class="variable">field_count</span> == <span class="number integer">0</span>) {
                <span class="comment">// No result set - not a SELECT, SHOW, DESCRIBE or EXPLAIN</span>
                <span class="comment">// UPDATE or DELETE?</span>
                <span class="variable">query_req</span>-&gt;<span class="variable">affected_rows</span> = <span class="variable">mysql_affected_rows</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);
                <span class="comment">// INSERT?</span>
                <span class="variable">query_req</span>-&gt;<span class="variable">insert_id</span> = <span class="variable">mysql_insert_id</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);
                <span class="variable">req</span>-&gt;<span class="variable">int1</span> = <span class="number integer">0</span>;
            } <span class="keyword">else</span> {
                <span class="comment">// Result store error</span>
                <span class="variable">req</span>-&gt;<span class="variable">result</span> = <span class="number integer">1</span>;
            }
        }
    }
    <span class="variable">pthread_mutex_unlock</span>(&amp;<span class="variable">conn</span>-&gt;<span class="variable">query_lock</span>);
    <span class="keyword">return</span> <span class="number integer">0</span>;
}
<span class="directive">#endif</span></code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Performs a query on the database</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  query</p></li><li><p><strong>param</strong>: <em>Function(error, result)</em>  callback</p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">Query</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;
<span class="directive">#ifdef MYSQL_NON_THREADSAFE</span>
    <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="class">MYSQL_NON_THREADSAFE_ERRORSTRING</span>);
<span class="directive">#else</span>
    <span class="class">REQ_STR_ARG</span>(<span class="number integer">0</span>, <span class="variable">query</span>);
    <span class="class">OPTIONAL_FUN_ARG</span>(<span class="number integer">1</span>, <span class="variable">callback</span>);

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">struct</span> <span class="variable">query_request</span> *<span class="variable">query_req</span> = (<span class="keyword">struct</span> <span class="variable">query_request</span> *)
        <span class="variable">calloc</span>(<span class="number integer">1</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <span class="variable">query_request</span>));

    <span class="keyword">if</span> (!<span class="variable">query_req</span>) {
        <span class="class">V8</span>::<span class="class">LowMemoryNotification</span>();
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;Could not allocate enough memory&quot;</span>);
    }

    <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="variable">query_len</span> = <span class="variable">static_cast</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt;(<span class="variable">query</span>.<span class="variable">length</span>());
    <span class="variable">query_req</span>-&gt;<span class="variable">query</span> =
        <span class="variable">reinterpret_cast</span>&lt;<span class="keyword">char</span> *&gt;(<span class="variable">calloc</span>(<span class="variable">query_len</span> + <span class="number integer">1</span>, <span class="keyword">sizeof</span>(<span class="keyword">char</span>))); <span class="comment">// NOLINT (have no char var)</span>

    <span class="keyword">if</span> (<span class="variable">snprintf</span>(<span class="variable">query_req</span>-&gt;<span class="variable">query</span>, <span class="variable">query_len</span> + <span class="number integer">1</span>, <span class="string">&quot;%s&quot;</span>, *<span class="variable">query</span>) !=
                                                <span class="variable">static_cast</span>&lt;<span class="keyword">int</span>&gt;(<span class="variable">query_len</span>)) {
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;Snprintf() error&quot;</span>);
    }

    <span class="variable">query_req</span>-&gt;<span class="variable">callback</span> = <span class="class">Persistent</span>&lt;<span class="class">Value</span>&gt;::<span class="class">New</span>(<span class="variable">callback</span>);
    <span class="variable">query_req</span>-&gt;<span class="variable">conn</span> = <span class="variable">conn</span>;

    <span class="variable">eio_custom</span>(<span class="class">EIO_Query</span>, <span class="class">EIO_PRI_DEFAULT</span>, <span class="class">EIO_After_Query</span>, <span class="variable">query_req</span>);

    <span class="variable">ev_ref</span>(<span class="class">EV_DEFAULT_UC</span>);
    <span class="variable">conn</span>-&gt;<span class="class">Ref</span>();

    <span class="keyword">return</span> <span class="class">Undefined</span>();
<span class="directive">#endif</span>
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Performs a query on the database</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  query</p></li><li><p><strong>param</strong>: <em>MysqlResult</em>  result</p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">QuerySync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">REQ_STR_ARG</span>(<span class="number integer">0</span>, <span class="variable">query</span>)

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">MYSQLCONN_DISABLE_MQ</span>;

    <span class="class">MYSQL_RES</span> *<span class="variable">my_result</span> = <span class="class">NULL</span>;
    <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="variable">field_count</span>;

    <span class="comment">// Only one query can be executed on a connection at a time</span>
    <span class="variable">pthread_mutex_lock</span>(&amp;<span class="variable">conn</span>-&gt;<span class="variable">query_lock</span>);

    <span class="keyword">int</span> <span class="variable">r</span> = <span class="variable">mysql_query</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>, *<span class="variable">query</span>);
    <span class="keyword">if</span> (<span class="variable">r</span> == <span class="number integer">0</span>) {
        <span class="variable">my_result</span> = <span class="variable">mysql_store_result</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);
        <span class="variable">field_count</span> = <span class="variable">mysql_field_count</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);
    }

    <span class="variable">pthread_mutex_unlock</span>(&amp;<span class="variable">conn</span>-&gt;<span class="variable">query_lock</span>);

    <span class="keyword">if</span> (<span class="variable">r</span> != <span class="number integer">0</span>) {
        <span class="comment">// Query error</span>
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">if</span> (!<span class="variable">my_result</span>) {
        <span class="keyword">if</span> (<span class="variable">field_count</span> == <span class="number integer">0</span>) {
            <span class="comment">// No result set - not a SELECT, SHOW, DESCRIBE or EXPLAIN</span>
            <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
        } <span class="keyword">else</span> {
            <span class="comment">// Error</span>
            <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
        }
    }

    <span class="keyword">int</span> <span class="variable">argc</span> = <span class="number integer">3</span>;
    <span class="class">Local</span>&lt;<span class="class">Value</span>&gt; <span class="variable">argv</span>[<span class="variable">argc</span>];
    <span class="variable">argv</span>[<span class="number integer">0</span>] = <span class="class">External</span>::<span class="class">New</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);
    <span class="variable">argv</span>[<span class="number integer">1</span>] = <span class="class">External</span>::<span class="class">New</span>(<span class="variable">my_result</span>);
    <span class="variable">argv</span>[<span class="number integer">2</span>] = <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">field_count</span>);
    <span class="class">Persistent</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result</span>(<span class="class">MysqlResult</span>::<span class="variable">constructor_template</span>-&gt;
                             <span class="class">GetFunction</span>()-&gt;<span class="class">NewInstance</span>(<span class="variable">argc</span>, <span class="variable">argv</span>));

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Rolls back current transaction</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">RollbackSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">if</span> (<span class="variable">mysql_rollback</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Opens a new connection to the MySQL server</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String | null</em>  hostname</p></li><li><p><strong>param</strong>: <em>String | null</em>  user</p></li><li><p><strong>param</strong>: <em>String | null</em>  password</p></li><li><p><strong>param</strong>: <em>String | null</em>  database</p></li><li><p><strong>param</strong>: <em>Integer | null</em>  port</p></li><li><p><strong>param</strong>: <em>String | null</em>  socket</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">RealConnectSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_INITIALIZED</span>;

    <span class="class">String</span>::<span class="class">Utf8Value</span> <span class="variable">hostname</span>(<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">ToString</span>());
    <span class="class">String</span>::<span class="class">Utf8Value</span> <span class="variable">user</span>(<span class="variable">args</span>[<span class="number integer">1</span>]-&gt;<span class="class">ToString</span>());
    <span class="class">String</span>::<span class="class">Utf8Value</span> <span class="variable">password</span>(<span class="variable">args</span>[<span class="number integer">2</span>]-&gt;<span class="class">ToString</span>());
    <span class="class">String</span>::<span class="class">Utf8Value</span> <span class="variable">dbname</span>(<span class="variable">args</span>[<span class="number integer">3</span>]-&gt;<span class="class">ToString</span>());
    <span class="variable">uint32_t</span> <span class="variable">port</span> = <span class="variable">args</span>[<span class="number integer">4</span>]-&gt;<span class="class">Uint32Value</span>();
    <span class="class">String</span>::<span class="class">Utf8Value</span> <span class="variable">socket</span>(<span class="variable">args</span>[<span class="number integer">5</span>]-&gt;<span class="class">ToString</span>());
    <span class="variable">uint64_t</span> <span class="variable">flags</span> = <span class="variable">args</span>[<span class="number integer">6</span>]-&gt;<span class="class">Uint32Value</span>();

    <span class="variable">bool</span> <span class="variable">r</span> = <span class="variable">conn</span>-&gt;<span class="class">RealConnect</span>(<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">IsString</span>() ? *<span class="variable">hostname</span> : <span class="class">NULL</span>,
                               <span class="variable">args</span>[<span class="number integer">1</span>]-&gt;<span class="class">IsString</span>() ? *<span class="variable">user</span>     : <span class="class">NULL</span>,
                               <span class="variable">args</span>[<span class="number integer">2</span>]-&gt;<span class="class">IsString</span>() ? *<span class="variable">password</span> : <span class="class">NULL</span>,
                               <span class="variable">args</span>[<span class="number integer">3</span>]-&gt;<span class="class">IsString</span>() ? *<span class="variable">dbname</span>   : <span class="class">NULL</span>,
                               <span class="variable">args</span>[<span class="number integer">4</span>]-&gt;<span class="class">IsUint32</span>() ? <span class="variable">port</span>      : <span class="number integer">0</span>,
                               <span class="variable">args</span>[<span class="number integer">5</span>]-&gt;<span class="class">IsString</span>() ? *<span class="variable">socket</span>   : <span class="class">NULL</span>,
                               <span class="variable">args</span>[<span class="number integer">6</span>]-&gt;<span class="class">IsUint32</span>() ? <span class="variable">flags</span>     : <span class="number integer">0</span>);

    <span class="keyword">if</span> (!<span class="variable">r</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Executes an SQL query</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  query</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">RealQuerySync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">REQ_STR_ARG</span>(<span class="number integer">0</span>, <span class="variable">query</span>)

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">MYSQLCONN_DISABLE_MQ</span>;

    <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="variable">query_len</span> = <span class="variable">static_cast</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt;(<span class="variable">query</span>.<span class="variable">length</span>());

    <span class="variable">pthread_mutex_lock</span>(&amp;<span class="variable">conn</span>-&gt;<span class="variable">query_lock</span>);
    <span class="keyword">int</span> <span class="variable">r</span> = <span class="variable">mysql_real_query</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>, *<span class="variable">query</span>, <span class="variable">query_len</span>);
    <span class="variable">pthread_mutex_unlock</span>(&amp;<span class="variable">conn</span>-&gt;<span class="variable">query_lock</span>);

    <span class="keyword">if</span> (<span class="variable">r</span> != <span class="number integer">0</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Selects the default database for database queries</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  database</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">SelectDbSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">REQ_STR_ARG</span>(<span class="number integer">0</span>, <span class="variable">dbname</span>)

    <span class="keyword">if</span> (<span class="variable">mysql_select_db</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>, *<span class="variable">dbname</span>)) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Sets the default client character set</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  charset</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">SetCharsetSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">REQ_STR_ARG</span>(<span class="number integer">0</span>, <span class="variable">charset</span>)

    <span class="keyword">if</span> (<span class="variable">mysql_set_character_set</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>, *<span class="variable">charset</span>)) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Sets options</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Integer</em>  option key</p></li><li><p><strong>param</strong>: <em>Integer | String</em>  option value</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">SetOptionSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">REQ_INT_ARG</span>(<span class="number integer">0</span>, <span class="variable">option_integer_key</span>);
    <span class="variable">mysql_option</span> <span class="variable">option_key</span> = <span class="variable">static_cast</span>&lt;<span class="variable">mysql_option</span>&gt;(<span class="variable">option_integer_key</span>);
    <span class="keyword">int</span> <span class="variable">r</span> = <span class="number integer">1</span>;

    <span class="keyword">switch</span> (<span class="variable">option_key</span>) {
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_CONNECT_TIMEOUT</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_PROTOCOL</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_READ_TIMEOUT</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_WRITE_TIMEOUT</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_RECONNECT</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_COMPRESS</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_SSL_VERIFY_SERVER_CERT</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_REPORT_DATA_TRUNCATION</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_SECURE_AUTH</span>:
            {
            <span class="class">REQ_INT_ARG</span>(<span class="number integer">1</span>, <span class="variable">option_integer_value</span>);
            <span class="variable">r</span> = <span class="variable">mysql_options</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>,
                              <span class="variable">option_key</span>,
                              <span class="variable">static_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">char</span> *&gt;(
                                <span class="variable">static_cast</span>&lt;<span class="keyword">const</span> <span class="keyword">void</span> *&gt;(
                                  &amp;<span class="variable">option_integer_value</span>)));
            <span class="comment">// MYSQL_OPT_RECONNECT option is modified by mysql_real_connect</span>
            <span class="comment">// due to bug in MySQL &lt; 5.1.6</span>
            <span class="comment">// Save it state and repeat mysql_options after connect</span>
            <span class="comment">// See issue #66</span>
<span class="directive">#if MYSQL_VERSION_ID</span> &gt;= <span class="number integer">50013</span> &amp;&amp; <span class="class">MYSQL_VERSION_ID</span> &lt; <span class="number integer">50106</span>
            <span class="keyword">if</span> (!<span class="variable">r</span> &amp;&amp; (<span class="variable">option_key</span> == <span class="class">MYSQL_OPT_RECONNECT</span>)) {
                <span class="variable">conn</span>-&gt;<span class="variable">opt_reconnect</span> = <span class="variable">option_integer_value</span>;
            }
<span class="directive">#endif</span>
            }
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="class">MYSQL_READ_DEFAULT_FILE</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_READ_DEFAULT_GROUP</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_INIT_COMMAND</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_SET_CHARSET_NAME</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_SET_CHARSET_DIR</span>:
            {
            <span class="class">REQ_STR_ARG</span>(<span class="number integer">1</span>, <span class="variable">option_string_value</span>);
            <span class="variable">r</span> = <span class="variable">mysql_options</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>, <span class="variable">option_key</span>, *<span class="variable">option_string_value</span>);
            }
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_LOCAL_INFILE</span>:
            <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;This option isn't implemented yet&quot;</span>);
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_NAMED_PIPE</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_SHARED_MEMORY_BASE_NAME</span>:
            <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;This option isn't used because Windows&quot;</span>);
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_GUESS_CONNECTION</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_SET_CLIENT_IP</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_USE_EMBEDDED_CONNECTION</span>:
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_USE_REMOTE_CONNECTION</span>:
            <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;This option isn't used because not embedded&quot;</span>);
            <span class="keyword">break</span>;
        <span class="keyword">case</span> <span class="class">MYSQL_OPT_USE_RESULT</span>:
        <span class="keyword">default</span>:
            <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;This option isn't supported by MySQL&quot;</span>);
    }

    <span class="keyword">if</span> (<span class="variable">r</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Sets SSL options
Used for establishing secure connections</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  key file</p></li><li><p><strong>param</strong>: <em>String</em>  certificate file</p></li><li><p><strong>param</strong>: <em>String</em>  certificate authority file</p></li><li><p><strong>param</strong>: <em>String</em>  CA certificates in PEM directory</p></li><li><p><strong>param</strong>: <em>String</em>  allowable ciphers</p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">SetSslSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="class">REQ_STR_ARG</span>(<span class="number integer">0</span>, <span class="variable">key</span>)
    <span class="class">REQ_STR_ARG</span>(<span class="number integer">1</span>, <span class="variable">cert</span>)
    <span class="class">REQ_STR_ARG</span>(<span class="number integer">2</span>, <span class="variable">ca</span>)
    <span class="class">REQ_STR_ARG</span>(<span class="number integer">3</span>, <span class="variable">capath</span>)
    <span class="class">REQ_STR_ARG</span>(<span class="number integer">4</span>, <span class="variable">cipher</span>)

    <span class="variable">mysql_ssl_set</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>, *<span class="variable">key</span>, *<span class="variable">cert</span>, *<span class="variable">ca</span>, *<span class="variable">capath</span>, *<span class="variable">cipher</span>);

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">Undefined</span>());
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns the SQLSTATE error from previous MySQL operation</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">SqlStateSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">V8STR</span>(<span class="variable">mysql_sqlstate</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Gets the current system status</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>String</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">StatSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="keyword">const</span> <span class="keyword">char</span> *<span class="variable">stat</span> = <span class="variable">mysql_stat</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">V8STR</span>(<span class="variable">stat</span> ? <span class="variable">stat</span> : <span class="string">&quot;&quot;</span>));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Transfers a result set from the last query</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>MysqlResult</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">StoreResultSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="keyword">if</span> (!<span class="variable">mysql_field_count</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)) {</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>

                </td>
                <td>
<pre><code> <span class="variable">no</span> <span class="variable">result</span> <span class="variable">set</span> - <span class="variable">not</span> <span class="variable">a</span> <span class="class">SELECT</span>, <span class="class">SHOW</span>, <span class="class">DESCRIBE</span> <span class="variable">or</span> <span class="class">EXPLAIN</span>, </code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>

                </td>
                <td>
<pre><code><span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
    }

    <span class="class">MYSQL_RES</span> *<span class="variable">my_result</span> = <span class="variable">mysql_store_result</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);

    <span class="keyword">if</span> (!<span class="variable">my_result</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">int</span> <span class="variable">argc</span> = <span class="number integer">3</span>;
    <span class="class">Local</span>&lt;<span class="class">Value</span>&gt; <span class="variable">argv</span>[<span class="variable">argc</span>];
    <span class="variable">argv</span>[<span class="number integer">0</span>] = <span class="class">External</span>::<span class="class">New</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);
    <span class="variable">argv</span>[<span class="number integer">1</span>] = <span class="class">External</span>::<span class="class">New</span>(<span class="variable">my_result</span>);
    <span class="variable">argv</span>[<span class="number integer">2</span>] = <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">mysql_field_count</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>));
    <span class="class">Persistent</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result</span>(<span class="class">MysqlResult</span>::<span class="variable">constructor_template</span>-&gt;
                             <span class="class">GetFunction</span>()-&gt;<span class="class">NewInstance</span>(<span class="variable">argc</span>, <span class="variable">argv</span>));

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns the thread ID for the current connection</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Integer</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">ThreadIdSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="variable">uint64_t</span> <span class="variable">thread_id</span> = <span class="variable">mysql_thread_id</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">Integer</span>::<span class="class">New</span>(<span class="variable">thread_id</span>));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns whether thread safety is given or not</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">ThreadSafeSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="keyword">if</span> (<span class="variable">mysql_thread_safe</span>()) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Initiates a result set retrieval</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>MysqlResult</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">UseResultSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="keyword">if</span> (!<span class="variable">mysql_field_count</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>)) {</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>

                </td>
                <td>
<pre><code> <span class="variable">no</span> <span class="variable">result</span> <span class="variable">set</span> - <span class="variable">not</span> <span class="variable">a</span> <span class="class">SELECT</span>, <span class="class">SHOW</span>, <span class="class">DESCRIBE</span> <span class="variable">or</span> <span class="class">EXPLAIN</span>, </code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>

                </td>
                <td>
<pre><code><span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
    }

    <span class="class">MYSQL_RES</span> *<span class="variable">my_result</span> = <span class="variable">mysql_use_result</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);

    <span class="keyword">if</span> (!<span class="variable">my_result</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">int</span> <span class="variable">argc</span> = <span class="number integer">3</span>;
    <span class="class">Local</span>&lt;<span class="class">Value</span>&gt; <span class="variable">argv</span>[<span class="variable">argc</span>];
    <span class="variable">argv</span>[<span class="number integer">0</span>] = <span class="class">External</span>::<span class="class">New</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);
    <span class="variable">argv</span>[<span class="number integer">1</span>] = <span class="class">External</span>::<span class="class">New</span>(<span class="variable">my_result</span>);
    <span class="variable">argv</span>[<span class="number integer">2</span>] = <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">mysql_field_count</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>));
    <span class="class">Persistent</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result</span>(<span class="class">MysqlResult</span>::<span class="variable">constructor_template</span>-&gt;
                             <span class="class">GetFunction</span>()-&gt;<span class="class">NewInstance</span>(<span class="variable">argc</span>, <span class="variable">argv</span>));

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns the number of warnings from the last query for the given link</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Integer</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlConnection</span>::<span class="class">WarningCountSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlConnection</span> *<span class="variable">conn</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlConnection</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLCONN_MUSTBE_CONNECTED</span>;

    <span class="variable">uint32_t</span> <span class="variable">warning_count</span> = <span class="variable">mysql_warning_count</span>(<span class="variable">conn</span>-&gt;<span class="variable">_conn</span>);

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">warning_count</span>));
}

</code></pre>
                </td>
            </tr>
            <tr class="filename">
                <td>
<h2 id="mysql_bindings_result">mysql_bindings_result</h2>
                </td>
                <td>
./src/mysql_bindings_result.cc
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Creates new MysqlResult object</p>

<ul><li><p><strong>constructor</strong></p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">New</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">REQ_EXT_ARG</span>(<span class="number integer">0</span>, <span class="variable">js_connection</span>);
    <span class="class">REQ_EXT_ARG</span>(<span class="number integer">1</span>, <span class="variable">js_result</span>);
    <span class="class">REQ_UINT_ARG</span>(<span class="number integer">2</span>, <span class="variable">field_count</span>);
    <span class="class">MYSQL</span> *<span class="variable">connection</span> = <span class="variable">static_cast</span>&lt;<span class="class">MYSQL</span>*&gt;(<span class="variable">js_connection</span>-&gt;<span class="class">Value</span>());
    <span class="class">MYSQL_RES</span> *<span class="variable">result</span> = <span class="variable">static_cast</span>&lt;<span class="class">MYSQL_RES</span>*&gt;(<span class="variable">js_result</span>-&gt;<span class="class">Value</span>());
    <span class="class">MysqlResult</span> *<span class="variable">my_res</span> = <span class="variable">new</span> <span class="class">MysqlResult</span>(<span class="variable">connection</span>, <span class="variable">result</span>, <span class="variable">field_count</span>);
    <span class="variable">my_res</span>-&gt;<span class="class">Wrap</span>(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="keyword">return</span> <span class="variable">args</span>.<span class="class">This</span>();
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Get the number of fields in a result</p>

<ul><li><strong>getter</strong></li></ul>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Integer | Undefined</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">FieldCountGetter</span>(<span class="class">Local</span>&lt;<span class="class">String</span>&gt; <span class="variable">property</span>,
                                                   <span class="keyword">const</span> <span class="class">AccessorInfo</span> &amp;<span class="variable">info</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">info</span>.<span class="class">Holder</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="keyword">if</span> (<span class="variable">res</span>-&gt;<span class="variable">field_count</span> &gt; <span class="number integer">0</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">res</span>-&gt;<span class="variable">field_count</span>));
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="class">Undefined</span>();
    }
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Adjusts the result pointer to an arbitary row in the result</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Integer</em>  The field offset</p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">DataSeekSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="class">REQ_UINT_ARG</span>(<span class="number integer">0</span>, <span class="variable">offset</span>)

    <span class="keyword">if</span> (<span class="variable">mysql_result_is_unbuffered</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>)) {
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;Function cannot be used with MYSQL_USE_RESULT&quot;</span>);
    }

    <span class="keyword">if</span> (<span class="variable">offset</span> &gt;= <span class="variable">mysql_num_rows</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>)) {
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;Invalid row offset&quot;</span>);
    }

    <span class="variable">mysql_data_seek</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>, <span class="variable">offset</span>);

    <span class="keyword">return</span> <span class="class">Undefined</span>();
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>EIO wrapper functions for MysqlResult::FetchAll
 </p>
                </td>
                <td>
<pre><code><span class="directive">#ifndef MYSQL_NON_THREADSAFE</span>
<span class="keyword">int</span> <span class="class">MysqlResult</span>::<span class="class">EIO_After_FetchAll</span>(<span class="variable">eio_req</span> *<span class="variable">req</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="variable">ev_unref</span>(<span class="class">EV_DEFAULT_UC</span>);
    <span class="keyword">struct</span> <span class="variable">fetchAll_request</span> *<span class="variable">fetchAll_req</span> =
        <span class="variable">reinterpret_cast</span>&lt;<span class="keyword">struct</span> <span class="variable">fetchAll_request</span> *&gt;(<span class="variable">req</span>-&gt;<span class="variable">data</span>);

    <span class="keyword">int</span> <span class="variable">argc</span> = <span class="number integer">1</span>;</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>

                </td>
                <td>
<pre><code> <span class="variable">node</span>.<span class="variable">js</span> <span class="variable">convention</span>, <span class="variable">there</span> <span class="variable">is</span> <span class="variable">always</span> <span class="variable">one</span> <span class="variable">argument</span> </code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>

                </td>
                <td>
<pre><code><span class="class">Local</span>&lt;<span class="class">Value</span>&gt; <span class="variable">argv</span>[<span class="number integer">3</span>];

    <span class="keyword">if</span> (<span class="variable">req</span>-&gt;<span class="variable">result</span>) {
        <span class="variable">argv</span>[<span class="number integer">0</span>] = <span class="class">V8EXC</span>(<span class="string">&quot;Error on fetching fields&quot;</span>);
    } <span class="keyword">else</span> {
        <span class="class">MYSQL_FIELD</span> *<span class="variable">fields</span> = <span class="variable">fetchAll_req</span>-&gt;<span class="variable">fields</span>;
        <span class="variable">uint32_t</span> <span class="variable">num_fields</span> = <span class="variable">fetchAll_req</span>-&gt;<span class="variable">num_fields</span>;
        <span class="class">MYSQL_ROW</span> <span class="variable">result_row</span>;
        <span class="keyword">unsigned</span> <span class="keyword">long</span> *<span class="variable">field_lengths</span>;
        <span class="variable">uint32_t</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">j</span> = <span class="number integer">0</span>;

        <span class="comment">// Get rows</span>
        <span class="class">Local</span>&lt;<span class="class">Array</span>&gt; <span class="variable">js_result</span> = <span class="class">Array</span>::<span class="class">New</span>();
        <span class="class">Local</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result_row</span>;
        <span class="class">Local</span>&lt;<span class="class">Value</span>&gt; <span class="variable">js_field</span>;

        <span class="variable">i</span> = <span class="number integer">0</span>;
        <span class="keyword">while</span> ((<span class="variable">result_row</span> = <span class="variable">mysql_fetch_row</span>(<span class="variable">fetchAll_req</span>-&gt;<span class="variable">res</span>-&gt;<span class="variable">_res</span>))) {
            <span class="variable">field_lengths</span> = <span class="variable">mysql_fetch_lengths</span>(<span class="variable">fetchAll_req</span>-&gt;<span class="variable">res</span>-&gt;<span class="variable">_res</span>);

            <span class="keyword">if</span> (<span class="variable">fetchAll_req</span>-&gt;<span class="variable">results_array</span>) {
              <span class="variable">js_result_row</span> = <span class="class">Array</span>::<span class="class">New</span>();
            } <span class="keyword">else</span> {
              <span class="variable">js_result_row</span> = <span class="class">Object</span>::<span class="class">New</span>();
            }

            <span class="keyword">for</span> (<span class="variable">j</span> = <span class="number integer">0</span>; <span class="variable">j</span> &lt; <span class="variable">num_fields</span>; <span class="variable">j</span>++) {
                <span class="variable">js_field</span> = <span class="class">GetFieldValue</span>(<span class="variable">fields</span>[<span class="variable">j</span>],
                                         <span class="variable">result_row</span>[<span class="variable">j</span>],
                                         <span class="variable">field_lengths</span>[<span class="variable">j</span>]);
                <span class="keyword">if</span> (<span class="variable">fetchAll_req</span>-&gt;<span class="variable">results_array</span>) {
                    <span class="variable">js_result_row</span>-&gt;<span class="class">Set</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">j</span>), <span class="variable">js_field</span>);
                } <span class="keyword">else</span> {
                    <span class="keyword">if</span> (<span class="variable">fetchAll_req</span>-&gt;<span class="variable">results_structured</span>) {
                        <span class="keyword">if</span> (!<span class="variable">js_result_row</span>-&gt;<span class="class">Has</span>(<span class="class">V8STR</span>(<span class="variable">fields</span>[<span class="variable">j</span>].<span class="variable">table</span>))) {
                            <span class="variable">js_result_row</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="variable">fields</span>[<span class="variable">j</span>].<span class="variable">table</span>),
                                               <span class="class">Object</span>::<span class="class">New</span>());
                        }
                        <span class="variable">js_result_row</span>-&gt;<span class="class">Get</span>(<span class="class">V8STR</span>(<span class="variable">fields</span>[<span class="variable">j</span>].<span class="variable">table</span>))-&gt;<span class="class">ToObject</span>()
                                     -&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="variable">fields</span>[<span class="variable">j</span>].<span class="variable">name</span>), <span class="variable">js_field</span>);
                    } <span class="keyword">else</span> {
                        <span class="variable">js_result_row</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="variable">fields</span>[<span class="variable">j</span>].<span class="variable">name</span>), <span class="variable">js_field</span>);
                    }
                }
            }

            <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">i</span>), <span class="variable">js_result_row</span>);

            <span class="variable">i</span>++;
        }

        <span class="keyword">if</span> (<span class="variable">i</span> != <span class="variable">mysql_num_rows</span>(<span class="variable">fetchAll_req</span>-&gt;<span class="variable">res</span>-&gt;<span class="variable">_res</span>)) {
            <span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="variable">errno</span> = <span class="variable">mysql_errno</span>(<span class="variable">fetchAll_req</span>-&gt;<span class="variable">res</span>-&gt;<span class="variable">_conn</span>);
            <span class="keyword">const</span> <span class="keyword">char</span> *<span class="variable">error</span> = <span class="variable">mysql_error</span>(<span class="variable">fetchAll_req</span>-&gt;<span class="variable">res</span>-&gt;<span class="variable">_conn</span>);
            <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="variable">error_string_length</span> = <span class="variable">strlen</span>(<span class="variable">error</span>) + <span class="number integer">20</span>;
            <span class="keyword">char</span>* <span class="variable">error_string</span> = <span class="variable">new</span> <span class="keyword">char</span>[<span class="variable">error_string_length</span>];
            <span class="variable">snprintf</span>(<span class="variable">error_string</span>, <span class="variable">error_string_length</span>, <span class="string">&quot;Fetch error #%d: %s&quot;</span>,
                     <span class="variable">errno</span>, <span class="variable">error</span>);

            <span class="variable">argv</span>[<span class="number integer">0</span>] = <span class="class">V8EXC</span>(<span class="variable">error_string</span>);
            <span class="variable">delete</span>[] <span class="variable">error_string</span>;
        } <span class="keyword">else</span> {
            <span class="comment">// Get fields info</span>
            <span class="class">Local</span>&lt;<span class="class">Array</span>&gt; <span class="variable">js_fields</span> = <span class="class">Array</span>::<span class="class">New</span>();

            <span class="keyword">for</span> (<span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">num_fields</span>; <span class="variable">i</span>++) {
                <span class="variable">js_result_row</span> = <span class="class">Object</span>::<span class="class">New</span>();
                <span class="class">AddFieldProperties</span>(<span class="variable">js_result_row</span>, &amp;<span class="variable">fields</span>[<span class="variable">i</span>]);

                <span class="variable">js_fields</span>-&gt;<span class="class">Set</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">i</span>), <span class="variable">js_result_row</span>);
            }

            <span class="variable">argv</span>[<span class="number integer">1</span>] = <span class="variable">js_result</span>;
            <span class="variable">argv</span>[<span class="number integer">2</span>] = <span class="variable">js_fields</span>;
            <span class="variable">argv</span>[<span class="number integer">0</span>] = <span class="class">Local</span>&lt;<span class="class">Value</span>&gt;::<span class="class">New</span>(<span class="class">Null</span>());
            <span class="variable">argc</span> = <span class="number integer">3</span>;
        }
    }

    <span class="class">TryCatch</span> <span class="variable">try_catch</span>;

    <span class="variable">fetchAll_req</span>-&gt;<span class="variable">callback</span>-&gt;<span class="class">Call</span>(<span class="class">Context</span>::<span class="class">GetCurrent</span>()-&gt;<span class="class">Global</span>(), <span class="variable">argc</span>, <span class="variable">argv</span>);

    <span class="keyword">if</span> (<span class="variable">try_catch</span>.<span class="class">HasCaught</span>()) {
        <span class="variable">node</span>::<span class="class">FatalException</span>(<span class="variable">try_catch</span>);
    }

    <span class="variable">fetchAll_req</span>-&gt;<span class="variable">callback</span>.<span class="class">Dispose</span>();
    <span class="variable">fetchAll_req</span>-&gt;<span class="variable">res</span>-&gt;<span class="class">Unref</span>();

    <span class="comment">// free the result object after callback</span>
    <span class="comment">// all of the rows have been gotten at this point</span>
    <span class="variable">fetchAll_req</span>-&gt;<span class="variable">res</span>-&gt;<span class="class">Free</span>();

    <span class="comment">// free eio state object</span>
    <span class="variable">free</span>(<span class="variable">fetchAll_req</span>);

    <span class="keyword">return</span> <span class="number integer">0</span>;
}

<span class="keyword">int</span> <span class="class">MysqlResult</span>::<span class="class">EIO_FetchAll</span>(<span class="variable">eio_req</span> *<span class="variable">req</span>) {
    <span class="keyword">struct</span> <span class="variable">fetchAll_request</span> *<span class="variable">fetchAll_req</span> =
        <span class="variable">reinterpret_cast</span>&lt;<span class="keyword">struct</span> <span class="variable">fetchAll_request</span> *&gt;(<span class="variable">req</span>-&gt;<span class="variable">data</span>);
    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="variable">fetchAll_req</span>-&gt;<span class="variable">res</span>;

    <span class="comment">// Errors: none</span>
    <span class="variable">fetchAll_req</span>-&gt;<span class="variable">fields</span> = <span class="variable">mysql_fetch_fields</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);
    <span class="comment">// Errors: none</span>
    <span class="variable">fetchAll_req</span>-&gt;<span class="variable">num_fields</span> = <span class="variable">mysql_num_fields</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);

    <span class="variable">req</span>-&gt;<span class="variable">result</span> = <span class="number integer">0</span>;

    <span class="keyword">return</span> <span class="number integer">0</span>;
}
<span class="directive">#endif</span></code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Fetches all result rows as an array</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Boolean | Object</em>  options (optional)</p></li><li><p><strong>param</strong>: <em>Function(error, rows)</em>  callback</p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">FetchAll</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;
<span class="directive">#ifdef MYSQL_NON_THREADSAFE</span>
    <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="class">MYSQL_NON_THREADSAFE_ERRORSTRING</span>);
<span class="directive">#else</span>
    <span class="keyword">int</span> <span class="variable">arg_pos</span> = <span class="number integer">0</span>;
    <span class="variable">bool</span> <span class="variable">results_array</span> = <span class="variable">false</span>;
    <span class="variable">bool</span> <span class="variable">results_structured</span> = <span class="variable">false</span>;

    <span class="keyword">if</span> (<span class="variable">args</span>.<span class="class">Length</span>() &gt; <span class="number integer">0</span>) {
        <span class="keyword">if</span> (<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">IsBoolean</span>()) {
            <span class="variable">results_array</span> = <span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">BooleanValue</span>();
            <span class="variable">arg_pos</span>++;
        } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">IsObject</span>() &amp;&amp; !<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">IsFunction</span>()) {
            <span class="keyword">if</span> (<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">ToObject</span>()-&gt;<span class="class">Has</span>(<span class="class">V8STR</span>(<span class="string">&quot;array&quot;</span>))) {
                <span class="variable">results_array</span> = <span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">ToObject</span>()
                                -&gt;<span class="class">Get</span>(<span class="class">V8STR</span>(<span class="string">&quot;array&quot;</span>))-&gt;<span class="class">BooleanValue</span>();
            }
            <span class="keyword">if</span> (<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">ToObject</span>()-&gt;<span class="class">Has</span>(<span class="class">V8STR</span>(<span class="string">&quot;structured&quot;</span>))) {
                <span class="variable">results_structured</span> = <span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">ToObject</span>()
                                     -&gt;<span class="class">Get</span>(<span class="class">V8STR</span>(<span class="string">&quot;structured&quot;</span>))-&gt;<span class="class">BooleanValue</span>();
            }
            <span class="variable">arg_pos</span>++;
        }
        <span class="comment">// NOT here: any function is object</span>
        <span class="comment">// arg_pos++;</span>
    }

    <span class="keyword">if</span> (<span class="variable">results_array</span> &amp;&amp; <span class="variable">results_structured</span>) {
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;You can't mix 'array' and 'structured' parameters&quot;</span>);
    }

    <span class="class">REQ_FUN_ARG</span>(<span class="variable">arg_pos</span>, <span class="variable">callback</span>)

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>()); <span class="comment">// NOLINT</span>

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="keyword">struct</span> <span class="variable">fetchAll_request</span> *<span class="variable">fetchAll_req</span> = (<span class="keyword">struct</span> <span class="variable">fetchAll_request</span> *)
        <span class="variable">calloc</span>(<span class="number integer">1</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <span class="variable">fetchAll_request</span>));

    <span class="keyword">if</span> (!<span class="variable">fetchAll_req</span>) {
        <span class="class">V8</span>::<span class="class">LowMemoryNotification</span>();
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;Could not allocate enough memory&quot;</span>);
    }

    <span class="variable">fetchAll_req</span>-&gt;<span class="variable">callback</span> = <span class="class">Persistent</span>&lt;<span class="class">Function</span>&gt;::<span class="class">New</span>(<span class="variable">callback</span>);
    <span class="variable">fetchAll_req</span>-&gt;<span class="variable">res</span> = <span class="variable">res</span>;
    <span class="variable">fetchAll_req</span>-&gt;<span class="variable">results_array</span> = <span class="variable">results_array</span>;
    <span class="variable">fetchAll_req</span>-&gt;<span class="variable">results_structured</span> = <span class="variable">results_structured</span>;

    <span class="variable">eio_custom</span>(<span class="class">EIO_FetchAll</span>, <span class="class">EIO_PRI_DEFAULT</span>, <span class="class">EIO_After_FetchAll</span>, <span class="variable">fetchAll_req</span>);

    <span class="variable">ev_ref</span>(<span class="class">EV_DEFAULT_UC</span>);
    <span class="variable">res</span>-&gt;<span class="class">Ref</span>();

    <span class="keyword">return</span> <span class="class">Undefined</span>();
<span class="directive">#endif</span>
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Fetches all result rows as an array</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Boolean | Object</em>  options (optional)</p></li><li><p><strong>return</strong>: <em>Array</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">FetchAllSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="variable">bool</span> <span class="variable">results_array</span> = <span class="variable">false</span>;
    <span class="variable">bool</span> <span class="variable">results_structured</span> = <span class="variable">false</span>;

    <span class="keyword">if</span> (<span class="variable">args</span>.<span class="class">Length</span>() &gt; <span class="number integer">0</span>) {
        <span class="keyword">if</span> (<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">IsBoolean</span>()) {
            <span class="variable">results_array</span> = <span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">BooleanValue</span>();
        } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">IsObject</span>()) {
            <span class="keyword">if</span> (<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">ToObject</span>()-&gt;<span class="class">Has</span>(<span class="class">V8STR</span>(<span class="string">&quot;array&quot;</span>))) {
                <span class="variable">results_array</span> = <span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">ToObject</span>()
                                -&gt;<span class="class">Get</span>(<span class="class">V8STR</span>(<span class="string">&quot;array&quot;</span>))-&gt;<span class="class">BooleanValue</span>();
            }
            <span class="keyword">if</span> (<span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">ToObject</span>()-&gt;<span class="class">Has</span>(<span class="class">V8STR</span>(<span class="string">&quot;structured&quot;</span>))) {
                <span class="variable">results_structured</span> = <span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">ToObject</span>()
                                     -&gt;<span class="class">Get</span>(<span class="class">V8STR</span>(<span class="string">&quot;structured&quot;</span>))-&gt;<span class="class">BooleanValue</span>();
            }
        }
    }

    <span class="keyword">if</span> (<span class="variable">results_array</span> &amp;&amp; <span class="variable">results_structured</span>) {
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;You can't mix 'array' and 'structured' parameters&quot;</span>);
    }

    <span class="class">MYSQL_FIELD</span> *<span class="variable">fields</span> = <span class="variable">mysql_fetch_fields</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);
    <span class="variable">uint32_t</span> <span class="variable">num_fields</span> = <span class="variable">mysql_num_fields</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);
    <span class="class">MYSQL_ROW</span> <span class="variable">result_row</span>;
    <span class="keyword">unsigned</span> <span class="keyword">long</span> *<span class="variable">field_lengths</span>;
    <span class="variable">uint32_t</span> <span class="variable">i</span> = <span class="number integer">0</span>, <span class="variable">j</span> = <span class="number integer">0</span>;

    <span class="class">Local</span>&lt;<span class="class">Array</span>&gt; <span class="variable">js_result</span> = <span class="class">Array</span>::<span class="class">New</span>();
    <span class="class">Local</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result_row</span>;
    <span class="class">Local</span>&lt;<span class="class">Value</span>&gt; <span class="variable">js_field</span>;

    <span class="variable">i</span> = <span class="number integer">0</span>;
    <span class="keyword">while</span> ( (<span class="variable">result_row</span> = <span class="variable">mysql_fetch_row</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>)) ) {
        <span class="variable">field_lengths</span> = <span class="variable">mysql_fetch_lengths</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);

        <span class="keyword">if</span> (<span class="variable">results_array</span>) {
            <span class="variable">js_result_row</span> = <span class="class">Array</span>::<span class="class">New</span>();
        } <span class="keyword">else</span> {
            <span class="variable">js_result_row</span> = <span class="class">Object</span>::<span class="class">New</span>();
        }

        <span class="keyword">for</span> (<span class="variable">j</span> = <span class="number integer">0</span>; <span class="variable">j</span> &lt; <span class="variable">num_fields</span>; <span class="variable">j</span>++) {
            <span class="variable">js_field</span> = <span class="class">GetFieldValue</span>(<span class="variable">fields</span>[<span class="variable">j</span>],
                                     <span class="variable">result_row</span>[<span class="variable">j</span>],
                                     <span class="variable">field_lengths</span>[<span class="variable">j</span>]);
            <span class="keyword">if</span> (<span class="variable">results_array</span>) {
                <span class="variable">js_result_row</span>-&gt;<span class="class">Set</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">j</span>), <span class="variable">js_field</span>);
            } <span class="keyword">else</span> {
                <span class="keyword">if</span> (<span class="variable">results_structured</span>) {
                    <span class="keyword">if</span> (!<span class="variable">js_result_row</span>-&gt;<span class="class">Has</span>(<span class="class">V8STR</span>(<span class="variable">fields</span>[<span class="variable">j</span>].<span class="variable">table</span>))) {
                        <span class="variable">js_result_row</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="variable">fields</span>[<span class="variable">j</span>].<span class="variable">table</span>),
                                           <span class="class">Object</span>::<span class="class">New</span>());
                    }
                    <span class="variable">js_result_row</span>-&gt;<span class="class">Get</span>(<span class="class">V8STR</span>(<span class="variable">fields</span>[<span class="variable">j</span>].<span class="variable">table</span>))-&gt;<span class="class">ToObject</span>()
                                 -&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="variable">fields</span>[<span class="variable">j</span>].<span class="variable">name</span>), <span class="variable">js_field</span>);
                } <span class="keyword">else</span> {
                    <span class="variable">js_result_row</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="variable">fields</span>[<span class="variable">j</span>].<span class="variable">name</span>), <span class="variable">js_field</span>);
                }
            }
        }

        <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">i</span>), <span class="variable">js_result_row</span>);

        <span class="variable">i</span>++;
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Fetch a result row as an array</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Array</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">FetchArraySync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="class">MYSQL_FIELD</span> *<span class="variable">fields</span> = <span class="variable">mysql_fetch_fields</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);
    <span class="variable">uint32_t</span> <span class="variable">num_fields</span> = <span class="variable">mysql_num_fields</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);
    <span class="variable">uint32_t</span> <span class="variable">j</span> = <span class="number integer">0</span>;

    <span class="class">Local</span>&lt;<span class="class">Array</span>&gt; <span class="variable">js_result_row</span>;
    <span class="class">Local</span>&lt;<span class="class">Value</span>&gt; <span class="variable">js_field</span>;

    <span class="class">MYSQL_ROW</span> <span class="variable">result_row</span> = <span class="variable">mysql_fetch_row</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);

    <span class="keyword">if</span> (!<span class="variable">result_row</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">unsigned</span> <span class="keyword">long</span> *<span class="variable">field_lengths</span> = <span class="variable">mysql_fetch_lengths</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);

    <span class="variable">js_result_row</span> = <span class="class">Array</span>::<span class="class">New</span>();

    <span class="keyword">for</span> ( <span class="variable">j</span> = <span class="number integer">0</span>; <span class="variable">j</span> &lt; <span class="variable">num_fields</span>; <span class="variable">j</span>++ ) {
        <span class="variable">js_field</span> = <span class="class">GetFieldValue</span>(<span class="variable">fields</span>[<span class="variable">j</span>], <span class="variable">result_row</span>[<span class="variable">j</span>], <span class="variable">field_lengths</span>[<span class="variable">j</span>]);

        <span class="variable">js_result_row</span>-&gt;<span class="class">Set</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">j</span>), <span class="variable">js_field</span>);
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result_row</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns meta-data of the next field in the result set</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Object</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">FetchFieldSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="class">MYSQL_FIELD</span> *<span class="variable">field</span>;

    <span class="class">Local</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result</span>;

    <span class="variable">field</span> = <span class="variable">mysql_fetch_field</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);

    <span class="keyword">if</span> (!<span class="variable">field</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="variable">js_result</span> = <span class="class">Object</span>::<span class="class">New</span>();
    <span class="class">AddFieldProperties</span>(<span class="variable">js_result</span>, <span class="variable">field</span>);

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Fetch meta-data for a single field</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Integer</em>  field number</p></li><li><p><strong>return</strong>: <em>Array</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">FetchFieldDirectSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) { <span class="comment">// NOLINT</span>
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="class">REQ_UINT_ARG</span>(<span class="number integer">0</span>, <span class="variable">field_num</span>)

    <span class="class">MYSQL_FIELD</span> *<span class="variable">field</span>;

    <span class="class">Local</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result</span>;

    <span class="variable">field</span> = <span class="variable">mysql_fetch_field_direct</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>, <span class="variable">field_num</span>);

    <span class="keyword">if</span> (!<span class="variable">field</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="variable">js_result</span> = <span class="class">Object</span>::<span class="class">New</span>();
    <span class="class">AddFieldProperties</span>(<span class="variable">js_result</span>, <span class="variable">field</span>);

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns an array of objects representing the fields in a result set</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Array</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">FetchFieldsSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="variable">uint32_t</span> <span class="variable">num_fields</span> = <span class="variable">mysql_num_fields</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);
    <span class="class">MYSQL_FIELD</span> *<span class="variable">field</span>;
    <span class="variable">uint32_t</span> <span class="variable">i</span> = <span class="number integer">0</span>;

    <span class="class">Local</span>&lt;<span class="class">Array</span>&gt; <span class="variable">js_result</span> = <span class="class">Array</span>::<span class="class">New</span>();
    <span class="class">Local</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result_obj</span>;

    <span class="keyword">for</span> (<span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">num_fields</span>; <span class="variable">i</span>++) {
        <span class="variable">field</span> = <span class="variable">mysql_fetch_field_direct</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>, <span class="variable">i</span>);

        <span class="variable">js_result_obj</span> = <span class="class">Object</span>::<span class="class">New</span>();
        <span class="class">AddFieldProperties</span>(<span class="variable">js_result_obj</span>, <span class="variable">field</span>);

        <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">i</span>), <span class="variable">js_result_obj</span>);
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns the lengths of the columns of the current row in the result set</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Array</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">FetchLengthsSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="variable">uint32_t</span> <span class="variable">num_fields</span> = <span class="variable">mysql_num_fields</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);
    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">int</span> *<span class="variable">lengths</span> = <span class="variable">mysql_fetch_lengths</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>); <span class="comment">// NOLINT</span>
    <span class="variable">uint32_t</span> <span class="variable">i</span> = <span class="number integer">0</span>;

    <span class="class">Local</span>&lt;<span class="class">Array</span>&gt; <span class="variable">js_result</span> = <span class="class">Array</span>::<span class="class">New</span>();

    <span class="keyword">if</span> (!<span class="variable">lengths</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">for</span> (<span class="variable">i</span> = <span class="number integer">0</span>; <span class="variable">i</span> &lt; <span class="variable">num_fields</span>; <span class="variable">i</span>++) {
        <span class="variable">js_result</span>-&gt;<span class="class">Set</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">i</span>),
                       <span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">lengths</span>[<span class="variable">i</span>]));
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Fetch a result row as an object</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Object</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">FetchObjectSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="class">MYSQL_FIELD</span> *<span class="variable">fields</span> = <span class="variable">mysql_fetch_fields</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);
    <span class="variable">uint32_t</span> <span class="variable">num_fields</span> = <span class="variable">mysql_num_fields</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);
    <span class="class">MYSQL_ROW</span> <span class="variable">result_row</span>;
    <span class="variable">uint32_t</span> <span class="variable">j</span> = <span class="number integer">0</span>;

    <span class="class">Local</span>&lt;<span class="class">Object</span>&gt; <span class="variable">js_result_row</span>;
    <span class="class">Local</span>&lt;<span class="class">Value</span>&gt; <span class="variable">js_field</span>;

    <span class="variable">result_row</span> = <span class="variable">mysql_fetch_row</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);

    <span class="keyword">if</span> (!<span class="variable">result_row</span>) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">unsigned</span> <span class="keyword">long</span> *<span class="variable">field_lengths</span> = <span class="variable">mysql_fetch_lengths</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>);

    <span class="variable">js_result_row</span> = <span class="class">Object</span>::<span class="class">New</span>();

    <span class="keyword">for</span> ( <span class="variable">j</span> = <span class="number integer">0</span>; <span class="variable">j</span> &lt; <span class="variable">num_fields</span>; <span class="variable">j</span>++ ) {
        <span class="variable">js_field</span> = <span class="class">GetFieldValue</span>(<span class="variable">fields</span>[<span class="variable">j</span>], <span class="variable">result_row</span>[<span class="variable">j</span>], <span class="variable">field_lengths</span>[<span class="variable">j</span>]);

        <span class="variable">js_result_row</span>-&gt;<span class="class">Set</span>(<span class="class">V8STR</span>(<span class="variable">fields</span>[<span class="variable">j</span>].<span class="variable">name</span>), <span class="variable">js_field</span>);
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="variable">js_result_row</span>);
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Set result pointer to a specified field offset</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>Integer</em>  field number</p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">FieldSeekSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="class">REQ_UINT_ARG</span>(<span class="number integer">0</span>, <span class="variable">field_num</span>)

    <span class="keyword">if</span> (<span class="variable">field_num</span> &gt;= <span class="variable">res</span>-&gt;<span class="variable">field_count</span>) {
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;Invalid field offset&quot;</span>);
    }

    <span class="variable">mysql_field_seek</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>, <span class="variable">field_num</span>);

    <span class="keyword">return</span> <span class="class">Undefined</span>();
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Returns the position of the field cursor</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Integer</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">FieldTellSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">Integer</span>::<span class="class">NewFromUnsigned</span>(<span class="variable">mysql_field_tell</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>)));
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Frees the memory associated with a result
 </p>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">FreeSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="variable">res</span>-&gt;<span class="class">Free</span>();

    <span class="keyword">return</span> <span class="class">Undefined</span>();
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Gets the number of rows in a result</p>

<h2></h2>

<ul><li><p><strong>return</strong>: <em>Integer</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlResult</span>::<span class="class">NumRowsSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlResult</span> *<span class="variable">res</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlResult</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">MYSQLRES_MUSTBE_VALID</span>;

    <span class="keyword">if</span> (<span class="variable">mysql_result_is_unbuffered</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>)) {
        <span class="keyword">return</span> <span class="class">THREXC</span>(<span class="string">&quot;Function cannot be used with MYSQL_USE_RESULT&quot;</span>);
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">Integer</span>::<span class="class">New</span>(<span class="variable">mysql_num_rows</span>(<span class="variable">res</span>-&gt;<span class="variable">_res</span>)));
}

</code></pre>
                </td>
            </tr>
            <tr class="filename">
                <td>
<h2 id="mysql_bindings_statement">mysql_bindings_statement</h2>
                </td>
                <td>
./src/mysql_bindings_statement.cc
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Create new MySQL statement object</p>

<ul><li><p><strong>constructor</strong></p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlStatement</span>::<span class="class">New</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">REQ_EXT_ARG</span>(<span class="number integer">0</span>, <span class="variable">js_stmt</span>);
    <span class="class">MYSQL_STMT</span> *<span class="variable">stmt</span> = <span class="variable">static_cast</span>&lt;<span class="class">MYSQL_STMT</span>*&gt;(<span class="variable">js_stmt</span>-&gt;<span class="class">Value</span>());
    <span class="class">MysqlStatement</span> *<span class="variable">my_stmt</span> = <span class="variable">new</span> <span class="class">MysqlStatement</span>(<span class="variable">stmt</span>);
    <span class="variable">my_stmt</span>-&gt;<span class="class">Wrap</span>(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="keyword">return</span> <span class="variable">args</span>.<span class="class">This</span>();
}</code></pre>
                </td>
            </tr>
            <tr class="code">
                <td>
<p>Prepare statement by given query</p>

<h2></h2>

<ul><li><p><strong>param</strong>: <em>String</em>  query</p></li><li><p><strong>return</strong>: <em>Boolean</em> </p></li></ul>
                </td>
                <td>
<pre><code><span class="class">Handle</span>&lt;<span class="class">Value</span>&gt; <span class="class">MysqlStatement</span>::<span class="class">PrepareSync</span>(<span class="keyword">const</span> <span class="class">Arguments</span>&amp; <span class="variable">args</span>) {
    <span class="class">HandleScope</span> <span class="variable">scope</span>;

    <span class="class">MysqlStatement</span> *<span class="variable">stmt</span> = <span class="class">OBJUNWRAP</span>&lt;<span class="class">MysqlStatement</span>&gt;(<span class="variable">args</span>.<span class="class">This</span>());

    <span class="class">REQ_STR_ARG</span>(<span class="number integer">0</span>, <span class="variable">query</span>)

    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">int</span> <span class="variable">query_len</span> = <span class="variable">args</span>[<span class="number integer">0</span>]-&gt;<span class="class">ToString</span>()-&gt;<span class="class">Utf8Length</span>();

    <span class="keyword">if</span> (<span class="variable">mysql_stmt_prepare</span>(<span class="variable">stmt</span>-&gt;<span class="variable">_stmt</span>, *<span class="variable">query</span>, <span class="variable">query_len</span>)) {
        <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">False</span>());
    }

    <span class="keyword">return</span> <span class="variable">scope</span>.<span class="class">Close</span>(<span class="class">True</span>());
}

</code></pre>
                </td>
            </tr>
        </tbody></table>
    </body>
</html>
